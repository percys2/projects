{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/percyscastillo/Desktop/proyectos%20coding/agro-erp-production-2/src/lib/supabase/server.js"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\n/**\n * Creates a Supabase client for use in API routes and Server Components.\n * Uses the user's session via cookies for RLS.\n * \n * Usage: In API routes (app/api/...) and Server Components\n * Example: const supabase = await createServerSupabaseClient();\n * \n * IMPORTANT: This function is async in Next.js 16+ because cookies() is async.\n */\nexport async function createServerSupabaseClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            );\n          } catch {\n            // Called from Server Component - can be ignored if middleware refreshes sessions\n          }\n        },\n      },\n    }\n  );\n}\n\n/**\n * Service Role client - bypasses RLS.\n * ONLY use in trusted server-side code (API routes) for admin operations.\n * \n * WARNING: This client has full database access. Never expose to client.\n */\nexport const supabaseAdmin = createSupabaseClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL,\n  process.env.SUPABASE_SERVICE_ROLE_KEY,\n  {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  }\n);\n\n// Aliases for backwards compatibility\nexport const createClient = createServerSupabaseClient;\nexport const supabase = supabaseAdmin;"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;AACA;;;;AAWO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,8MAAO;IAEjC,OAAO,IAAA,mQAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,iFAAiF;gBACnF;YACF;QACF;IACF;AAEJ;AAQO,MAAM,gBAAgB,IAAA,2QAAoB,gFAE/C,QAAQ,GAAG,CAAC,yBAAyB,EACrC;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF;AAIK,MAAM,eAAe;AACrB,MAAM,WAAW"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///Users/percyscastillo/Desktop/proyectos%20coding/agro-erp-production-2/app/api/kardex/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { createServerSupabaseClient } from \"@/src/lib/supabase/server\";\n\nexport async function GET(req) {\n  try {\n    const supabase = await createServerSupabaseClient();\n\n    const orgSlug = req.headers.get(\"x-org-slug\");\n    const productId = req.headers.get(\"x-product-id\");\n    const branchId = req.headers.get(\"x-branch-id\");\n    const movementType = req.headers.get(\"x-movement-type\");\n    const search = req.headers.get(\"x-search\") || \"\";\n\n    const url = new URL(req.url);\n    const startDate = url.searchParams.get(\"startDate\");\n    const endDate = url.searchParams.get(\"endDate\");\n    const limit = Number(url.searchParams.get(\"limit\") || 50);\n    const offset = Number(url.searchParams.get(\"offset\") || 0);\n\n    if (!orgSlug)\n      return NextResponse.json({ success: false, error: \"Missing org slug\" });\n\n    // Get org_id\n    const { data: org } = await supabase\n      .from(\"organizations\")\n      .select(\"id\")\n      .eq(\"slug\", orgSlug)\n      .single();\n\n    if (!org)\n      return NextResponse.json({ success: false, error: \"Org not found\" });\n\n    let query = supabase\n      .from(\"kardex_view\")\n      .select(\"*\")\n      .eq(\"org_id\", org.id)\n      .range(offset, offset + limit - 1)\n      .order(\"created_at\", { ascending: false });\n\n    if (productId && productId !== \"all\")\n      query = query.eq(\"product_id\", productId);\n\n    if (branchId && branchId !== \"all\") {\n      query = query.or(\n        `from_branch.eq.${branchId},to_branch.eq.${branchId},branch_id.eq.${branchId}`\n      );\n    }\n\n    if (movementType && movementType !== \"all\")\n      query = query.eq(\"movement_type\", movementType);\n\n    // Search text\n    if (search) {\n      query = query.or(\n        `product_name.ilike.%${search}%,reference.ilike.%${search}%,user_email.ilike.%${search}%`\n      );\n    }\n\n    if (startDate)\n      query = query.gte(\"created_at\", `${startDate} 00:00:00`);\n\n    if (endDate)\n      query = query.lte(\"created_at\", `${endDate} 23:59:59`);\n\n    const { data, error } = await query;\n    if (error) throw error;\n\n    return NextResponse.json({ success: true, data });\n\n  } catch (err) {\n    return NextResponse.json({\n      success: false,\n      error: err.message,\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,kOAA0B;QAEjD,MAAM,UAAU,IAAI,OAAO,CAAC,GAAG,CAAC;QAChC,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC;QAClC,MAAM,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC;QACjC,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC;QACrC,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe;QAE9C,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,YAAY,IAAI,YAAY,CAAC,GAAG,CAAC;QACvC,MAAM,UAAU,IAAI,YAAY,CAAC,GAAG,CAAC;QACrC,MAAM,QAAQ,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY;QACtD,MAAM,SAAS,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,aAAa;QAExD,IAAI,CAAC,SACH,OAAO,kNAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAmB;QAEvE,aAAa;QACb,MAAM,EAAE,MAAM,GAAG,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,iBACL,MAAM,CAAC,MACP,EAAE,CAAC,QAAQ,SACX,MAAM;QAET,IAAI,CAAC,KACH,OAAO,kNAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAgB;QAEpE,IAAI,QAAQ,SACT,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAU,IAAI,EAAE,EACnB,KAAK,CAAC,QAAQ,SAAS,QAAQ,GAC/B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,aAAa,cAAc,OAC7B,QAAQ,MAAM,EAAE,CAAC,cAAc;QAEjC,IAAI,YAAY,aAAa,OAAO;YAClC,QAAQ,MAAM,EAAE,CACd,CAAC,eAAe,EAAE,SAAS,cAAc,EAAE,SAAS,cAAc,EAAE,UAAU;QAElF;QAEA,IAAI,gBAAgB,iBAAiB,OACnC,QAAQ,MAAM,EAAE,CAAC,iBAAiB;QAEpC,cAAc;QACd,IAAI,QAAQ;YACV,QAAQ,MAAM,EAAE,CACd,CAAC,oBAAoB,EAAE,OAAO,mBAAmB,EAAE,OAAO,oBAAoB,EAAE,OAAO,CAAC,CAAC;QAE7F;QAEA,IAAI,WACF,QAAQ,MAAM,GAAG,CAAC,cAAc,GAAG,UAAU,SAAS,CAAC;QAEzD,IAAI,SACF,QAAQ,MAAM,GAAG,CAAC,cAAc,GAAG,QAAQ,SAAS,CAAC;QAEvD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAC9B,IAAI,OAAO,MAAM;QAEjB,OAAO,kNAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IAEjD,EAAE,OAAO,KAAK;QACZ,OAAO,kNAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO,IAAI,OAAO;QACpB;IACF;AACF"}}]
}